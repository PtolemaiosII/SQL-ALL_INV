CREATE OR ALTER VIEW RANKED_MEMO (DATECREATED,MEMO,RECORDID,TABLEID,USERNAME,RANK,REV_RANK,OVERALL_RANK,TABLENAME,REF) AS    SELECT
	M.DATECREATED AS DATECREATED,
	M.MEMO AS MEMO,
	M.RECORDID AS RECORDID,
	M.TABLEID AS TABLEID,
	M.USERNAME AS USERNAME,
	COUNT(M2.DATECREATED)+1 AS RANK,
	COUNT(M3.DATECREATED)+1 AS REV_RANK,
    OVER.OVERALL_RANK,
	T.TABLEREFNAME AS TABLENAME,
	COALESCE(PO.NUM, PART.NUM, VENDOR.NAME, CUSTOMER.NAME) AS REF
FROM
	MEMO AS M
	LEFT OUTER JOIN MEMO AS M2 ON (M2.RECORDID = M.RECORDID AND M2.DATECREATED < M.DATECREATED)
	LEFT OUTER JOIN MEMO AS M3 ON (M3.RECORDID = M.RECORDID AND M3.DATECREATED > M.DATECREATED)
    INNER JOIN (SELECT MEMO.ID, COUNT(MEMO2.DATECREATED)+1 AS OVERALL_RANK FROM MEMO LEFT OUTER JOIN MEMO AS MEMO2 ON MEMO2.DATECREATED > MEMO.DATECREATED GROUP BY 1) AS OVER ON OVER.ID = M.ID
	INNER JOIN TABLEREFERENCE AS T ON M.TABLEID = T.TABLEID
	LEFT OUTER JOIN PART ON (PART.ID = M.RECORDID AND M.TABLEID = -2003201472)
	LEFT OUTER JOIN PO ON (PO.ID = M.RECORDID AND M.TABLEID = 397076832)
	LEFT OUTER JOIN VENDOR ON (VENDOR.ID = M.RECORDID AND M.TABLEID = -850561568)
	LEFT OUTER JOIN CUSTOMER ON (CUSTOMER.ID = M.RECORDID AND M.TABLEID = 2142022944)
GROUP BY 1,2,3,4,5,8,9,10;
